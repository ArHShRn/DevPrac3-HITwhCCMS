[TOC]

**需要被加密保存到数据库中的内容项目，以星号标注**

目前一共 6 张表，遵循 3NF 规范。

- 账号申诉表
- 校园卡丢失表
- 用户反馈表
- 用户基本表
- 用户密保表
- 用户扩展表

# 登陆前

## 1. 用户登录

以下三级标题功能根据 MainWindow.xaml 窗口划分

### 1.1 找回密码

#### 1.1.1 密保问题找回

- 涉及用户基本表

用户通过自己设置的密保问题找回密码；

#### 1.1.2 账号申诉

- SQL表项 - 账号申诉表

用户在系统提交申诉请求，提供最近几条消费记录、消费地点、大概消费金额等数据；

系统生成一个唯一的申诉号反馈给用户，用户使用申诉号进行进度查询；

此外系统将会生成一个.tmp临时文件加密保存用户的相关信息。

系统将把申诉请求发送给管理员 Message Box，管理员有 **单独的功能界面** 来处理申诉请求并将结果实时反馈到申诉SQL；

| 申诉用户学号 | 申诉号 | 最近消费记录1地点 | 最近消费记录1金额 | 最近消费记录2地点 | 最近消费记录2金额 | 申诉状态 | 申诉是否被修改 | 占用学号  |
| ------------ | ------ | ----------------- | ----------------- | ----------------- | ----------------- | -------- | -------------- | --------- |
| 160400xxx    | HASH   | DIST1             | VALUE1            | DIST2             | VALUE2            | 0/1/2/3  | false          | 160400xxx |

- 申诉状态
  - 0 - 未被查看
  - 1 - 查看但尚未做出决定
  - 2 - 被同意
  - 3 - 被拒绝

### 1.2 更多功能

#### 1.2.1 校园卡丢失信息梗概

- SQL表项 - 校园卡丢失表

丢失信息更改仅显示最新的10条丢失记录，更详细的丢失记录需要用户登陆过后才能够查看。

| 丢失用户学号 | 丢失地点 | 丢失时间 | 附加信息 |
| ------------ | -------- | -------- | -------- |
| 160400xxx    | DIST1    | DATA1    | STRING   |

#### 1.2.2 部分网页链接

提供导航到校园官网、教务系统等，以及常用网址等等的网址导航。

#### 1.2.3 申诉进度查询

- 涉及账号申诉表

输入学号以及申诉号进行查询。（必须两项都输入）

系统首先扫描本地文件查看是否存在加密的申诉临时文件，如果存在则提交信息查询并直接进行状态显示，无需用户再次输入信息，以方便用户。

#### 1.2.4 关于

LOGO，CopyRight，Introduction，etc.

#### 1.2.5 反馈

- SQL表项 - 用户反馈表

用户可以提建议或者意见。

| 反馈用户学号          | 打分   | 反馈类型 | 反馈内容 |
| --------------------- | ------ | -------- | -------- |
| 160400xxx - STRING(9) | 0-10分 | ENUM     | STRING   |

- 反馈类型枚举

  - 0 - BUG反馈
  - 1 - UI界面功能建议
  - 2 - 系统功能建议

  - 3 - 仅评分

其中“仅评分”项的高分内容将会被筛选并滚动显示在登陆后界面的主页。

### 1.3 普通用户登陆

- SQL表项 - 用户基本表

储存用户基本信息

| 学号      | 密码   | 密保问题1是否自定 | 密保问题2是否自定 | 是否激活     | 所在用户组 |
| --------- | ------ | ----------------- | ----------------- | ------------ | ---------- |
| STRING(9) | STRING | true / false      | true / false      | true / false | ENUM       |

- SQL表项 - 用户密保表

| 学号      | 密保问题1内容 | 密保问题1答案 | 密保问题2内容 | 密保问题2答案 |
| --------- | ------------- | ------------- | ------------- | ------------- |
| STRING(9) | STRING        | STRING        | STRING        | SRTING        |

- SQL表项 - 用户扩展表

| 学号      | 头像编号 | 昵称      | 等级      | 手机       | 邮箱     | 最后一次在线时间 | 在线状态 | 自定状态 | 校园卡是否丢失 |
| --------- | -------- | --------- | --------- | ---------- | -------- | ---------------- | -------- | -------- | -------------- |
| STRING(9) | ENUM     | STRING(9) | SHROT_INT | STRING(11) | 综合判断 | DATE             | ENUM     | STRING   | BOOLEAN        |

头像编号（一共10个系统头像）（至少三个头像要有猫）

邮箱：正则表达式[a-z0-9]+@[a-z0-9]+.[a-z]2+

在线状态：

- 0 - 在线
- 1 - 离开
- 2 - 在线自定
- 3 - 离开自定

### 1.4 最新动态

- 涉及校园卡丢失表

仅显示最近十条

## 2. 新用户入驻（激活）

输入学号后判断此用户是否激活，如果已经激活则返回，如果没有激活则进入激活流程；

### 2.1 身份证有效性验证

利用数据集验证身份证有效性（百度）

### 2.2 密码与密保设置

通过验证后提示用户开始进行密码与密保问题的设置

### 2.3 完善个人信息

让用户完善个人信息（有的内容可以跳过）

### 2.4 进入登陆后界面